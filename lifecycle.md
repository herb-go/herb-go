# 标准 Herb-go 程序生命周期

## 阶段列表

- 环境变量初始化
- Package 初始化阶段
- 加锁
- 目录结构初始化阶段
- 加载并监听配置文件阶段
- 初始化模块阶段
- 程序运行阶段
- 卸载模块阶段
- 停止监听配置文件阶段
- 解锁

### 环境变量初始化

加载环境变量，用于在加载配置文件之前进行程序设置

### Package 初始化阶段

Package 初始化阶段指引入代码 package 时通过 package 的 init 函数进行代码初始化的阶段。该初始化阶段不应该影像程序运行的参数，并且只会执行一次

模块的初始化/卸载程序和配置文件的加载程序一般在这个阶段加载

### 加锁

对程序锁进行加锁，进入正式的程序运行阶段。从这个阶段开始不应该再对配置文件或者目录结构进行调整

### 目录结构初始化阶段

通过 github.com/herb-go/herb-go/util 包进行标准程序目录位置的设置。需要运行锁没有被锁住

### 加载并监听配置文件阶段

通过 github.com/herb-go/herb-go/util/config 包进行配置文件的载入。需要运行锁没有被锁住

### 初始化模块阶段

按加载的名字的顺序执行所有注册过的模块初始化程序

### 程序首次运行初始化

通过设置的环境变量，进行程序的首次运行初始化。

当首次运行初始化开启时，后续代码的生命周期将不会执行

### 程序运行阶段

所有在运行阶段可能会改变的配置文件对象需要通过原子操作加载

进行正常的程序功能服务

### 卸载模块阶段

在接受到程序退出信号或者程序自己终止服务时。开始卸载模块。

模块卸载函数在 Package 初始化阶段和初始化程序一起注册

卸载模块主要是为了模块再次启用做准备

### 停止监听配置文件阶段

停止所有注册过的配置文件文件接听程序。以便重新监听和加载配置文件。

### 解锁

解除运行程序锁，使得程序进行可以自由配置文件结构与配置文件的阶段，随时可以重新启动

## 关于测试

在对应用程序进行设置时，测试程序应该接管目录结构初始化部分，并传入一次性的参数进行程序的启动。以整个初始化模块到解锁之间的部分进行测试
